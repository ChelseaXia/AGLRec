# AGLRec: èåˆè¯­è¨€æ¨¡å‹ä¸å›¾ç¥ç»ç½‘ç»œçš„ä¸ªæ€§åŒ–åŠ¨ç”»æ¨èç³»ç»Ÿ

æœ¬é¡¹ç›®æå‡ºäº†ä¸€ç§ç»“åˆé¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä¸å›¾ç¥ç»ç½‘ç»œï¼ˆLightGCNï¼‰çš„æ¨èç³»ç»Ÿæ–¹æ³•ï¼Œæ—¨åœ¨æå‡æ•°æ®ç¨€ç–ä¸å†·å¯åŠ¨åœºæ™¯ä¸‹çš„æ¨èæ•ˆæœï¼Œç‰¹åˆ«é¢å‘åŠ¨ç”»ï¼ˆAnimeï¼‰æ¨èä»»åŠ¡ã€‚

## ğŸ“Œ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ config.py              # è¶…å‚æ•°ä¸è·¯å¾„é…ç½®
â”œâ”€â”€ main.py                # ä¸»å…¥å£ï¼šè®­ç»ƒ / æ¨ç† / æ¨èç”Ÿæˆ
â”œâ”€â”€ model.py               # LightGCN æ¨¡å‹å®šä¹‰ï¼Œæ”¯æŒè¯­ä¹‰èåˆ
â”œâ”€â”€ trainer.py             # è®­ç»ƒæµç¨‹å®ç°ï¼ˆBPR loss + Early Stopï¼‰
â”œâ”€â”€ evaluator.py           # æ¨èè¯„ä¼°æŒ‡æ ‡ï¼ˆRecall/NDCG/Hit/AUCï¼‰
â”œâ”€â”€ data_loader.py         # æ•°æ®é¢„å¤„ç†ä¸å›¾æ„å»º
â”œâ”€â”€ llm_embedding.py       # ç”¨æˆ·ä¸ç‰©å“çš„æ–‡æœ¬åµŒå…¥ç”Ÿæˆ
â”œâ”€â”€ save_embeddings.py     # æ‰¹é‡ç”Ÿæˆå¹¶ä¿å­˜ LLM åµŒå…¥
â”œâ”€â”€ recommend.py           # ç”Ÿæˆæœ€ç»ˆæ¨è Top-K åˆ—è¡¨
â”œâ”€â”€ run_ablation.py        # æ¶ˆèå®éªŒè„šæœ¬
â”œâ”€â”€ requirements.txt       # æ‰€éœ€ä¾èµ–åŒ…
â””â”€â”€ data/
    â”œâ”€â”€ anime.tsv          # åŠ¨ç”»å…ƒæ•°æ®ï¼ˆåŒ…å«æ ‡é¢˜ã€æ ‡ç­¾ã€ç®€ä»‹ï¼‰
    â”œâ”€â”€ user.tsv          # ç”¨æˆ·å…ƒæ•°æ®ï¼ˆåŒ…å«ç”¨æˆ·IDã€ç”¨æˆ·åã€æ³¨å†Œæ—¶é—´ï¼‰
    â””â”€â”€ interactions.tsv   # ç”¨æˆ·äº¤äº’è®°å½•ï¼ˆè¯„åˆ†ã€è¯„è®ºç­‰ï¼‰
```

## ğŸ§  æ¨¡å‹ç®€ä»‹

AGLRec æ¶æ„åŸºäº `LightGCN`ï¼Œå¹¶é€šè¿‡ä¸¤ç§æ–¹å¼èåˆç”¨æˆ·å’Œç‰©å“çš„è¯­ä¹‰åµŒå…¥ï¼š

- **èåˆæ–¹å¼ï¼š** `sum` / `concat`
- **è¯­ä¹‰æ¥æºï¼š** ç”¨æˆ·è¯„è®º + ç•ªå‰§æ ‡ç­¾ä¸ç®€ä»‹
- **é¢„è®­ç»ƒæ¨¡å‹ï¼š** é»˜è®¤ä½¿ç”¨ [`BAAI/bge-m3`](https://huggingface.co/BAAI/bge-m3)

## âš™ï¸ å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

æ¨èä½¿ç”¨ Python 3.8+ï¼Œé¡¹ç›®é»˜è®¤ä½¿ç”¨ GPUï¼ˆå¦‚å¯ç”¨ï¼‰ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å‡†å¤‡æ•°æ®

å°†ä»¥ä¸‹æ–‡ä»¶æ”¾å…¥ `data/` ç›®å½•ä¸‹ï¼š

- `user.tsv`ï¼šç”¨æˆ·å…ƒæ•°æ®
- `anime.tsv`ï¼šåŠ¨ç”»å…ƒæ•°æ®
- `interactions.tsv`ï¼šç”¨æˆ·-ç‰©å“äº¤äº’
  
### 2. ç”Ÿæˆè¯­ä¹‰åµŒå…¥ï¼ˆå¯é€‰ï¼‰

```bash
python save_embeddings.py
```

> å¯é€šè¿‡ä¿®æ”¹ `save_embeddings.py` æˆ– `config.py` ä¸­çš„ `model_name` æ¥æ›¿æ¢ç¼–ç å™¨ï¼ˆå¦‚æ”¹ä¸º Sentence-BERTï¼‰ã€‚

### 3. å¯åŠ¨è®­ç»ƒæµç¨‹

```bash
python main.py
```

å°†è‡ªåŠ¨å®Œæˆæ•°æ®åŠ è½½ã€å›¾æ„å»ºã€è®­ç»ƒã€è¯„ä¼°ä¸æ¨èç”Ÿæˆï¼Œç»“æœä¿å­˜åœ¨ `saved/` ç›®å½•ä¸­ã€‚

### 4. æ¶ˆèå®éªŒ

```bash
python run_ablation.py
```

ä¼šè‡ªåŠ¨éå† 8 ç§é…ç½®ç»„åˆï¼ˆèåˆæ–¹å¼ Ã— èåˆç»´åº¦ï¼‰ï¼Œå¯¹æ¯”æ€§èƒ½è¡¨ç°ã€‚

## ğŸ“ˆ æ¨èæŒ‡æ ‡

å†…ç½®æ”¯æŒä»¥ä¸‹è¯„ä¼°æŒ‡æ ‡ï¼š

- `NDCG@K`
- `Hit@K`
- `AUC`

## ğŸ“ ç»“æœæ–‡ä»¶

| è·¯å¾„ | è¯´æ˜ |
|------|------|
| `saved/best_model.pth`         | è®­ç»ƒåçš„æœ€ä½³æ¨¡å‹æƒé‡ |
| `saved/user_emb.pt`            | ç”¨æˆ· GCN è¡¨ç¤ºå‘é‡ |
| `saved/item_emb.pt`            | ç‰©å“ GCN è¡¨ç¤ºå‘é‡ |
| `saved/recommendations.json`   | æ¯ä¸ªç”¨æˆ·çš„æ¨èç»“æœ |
| `saved/train_user_dict.pkl`    | è®­ç»ƒé›†ä¸­ç”¨æˆ·çš„æ­£æ ·æœ¬å­—å…¸ |
| `saved/item_llm_embeddings.npy`| ç‰©å“è¯­ä¹‰åµŒå…¥ï¼ˆå¯é€‰ï¼‰ |
| `saved/user_llm_embeddings.npy`| ç”¨æˆ·è¯­ä¹‰åµŒå…¥ï¼ˆå¯é€‰ï¼‰ |

## ğŸ“Œ é…ç½®è¯´æ˜ï¼ˆconfig.pyï¼‰

å¯é€šè¿‡ `config.py` ç»Ÿä¸€ç®¡ç†è·¯å¾„ã€è®­ç»ƒå‚æ•°ã€æ¨¡å‹è®¾ç½®ç­‰ï¼Œä¾‹å¦‚ï¼š

```python
"embedding_dim": 64,
"num_layers": 1,
"fusion_mode": "concat",  # å¯é€‰ "sum"
"use_user_llm": True,
"use_item_llm": True,
"epochs": 20,
"lr": 0.001,
"device": "cuda",
```

## ğŸ§ª æ¶ˆèè®¾ç½®ç¤ºä¾‹

è¿è¡Œ `run_ablation.py` å°†æµ‹è¯•ä»¥ä¸‹ç»„åˆï¼š

- ä¸ä½¿ç”¨è¯­ä¹‰åµŒå…¥
- ä»…èåˆç”¨æˆ·è¯­ä¹‰ / ä»…èåˆç‰©å“è¯­ä¹‰
- åŒæ—¶èåˆç”¨æˆ·ä¸ç‰©å“
- `sum` vs `concat` èåˆæ–¹å¼

æ¯æ¬¡å®éªŒå‡ä¿å­˜ lossã€æŒ‡æ ‡ä¸æ¨¡å‹æƒé‡ï¼Œä¾›åç»­åˆ†æã€‚

